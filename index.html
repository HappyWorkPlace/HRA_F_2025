<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>HRA Cinema Club - Seat</title>
<style>
  /* ============ CONFIGURATION ============ */
  :root{
    /* Seat images from Google Drive */
    --img-regular: url("https://drive.google.com/thumbnail?id=13EpT70QOGuThPHaCsbD44Q4cdMUpElfL&sz=w80");
    --img-vip:     url("https://drive.google.com/thumbnail?id=1TSU5WQqDC5lrWYN8SSq9agRVLfSsFHUu&sz=w80");
    --img-sweet: url("https://drive.google.com/thumbnail?id=1Du01KILJxPZZQf0vZnABSilXcMfqNX32&sz=w80");

    /* Person icon (white) for selected seats */
    --img-person: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>\
  <circle cx='32' cy='20' r='10' fill='none' stroke='%23fff' stroke-width='4'/>\
  <path d='M16 52c0-8.84 7.16-16 16-16s16 7.16 16 16' fill='none' stroke='%23fff' stroke-width='4' stroke-linecap='round'/>\
</svg>");

    /* Dark theme colors */
    --bg:#0a0c10; 
    --panel:#12151c; 
    --line:#1f2530; 
    --text:#f0f2f5; 
    --muted:#8892a0;
    --accent:#ff6b6b;
    --vip:#ffc93d;
    --sweet:#ff69b4;
    --success:#4caf50;
  }

  * { 
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
  
  html, body {
    height: 100%;
    overflow: hidden;
  }
  
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(135deg, #0a0c10 0%, #1a1d26 100%);
    color: var(--text);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .container {
    width: 100%;
    height: 100%;
    max-width: 100vw;
    max-height: 100vh;
    background: var(--panel);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ===== HEADER ===== */
  header {
    background: linear-gradient(135deg, #1f2530 0%, var(--panel) 100%);
    padding: 1vh 2vw;
    text-align: center;
    border-bottom: 1px solid var(--line);
    flex-shrink: 0;
    position: relative;
  }
  
  .event-title {
    font-size: clamp(0.6rem, 1.2vw, 0.8rem);
    font-weight: 600;
    letter-spacing: 0.15em;
    color: var(--vip);
    text-transform: uppercase;
    margin-bottom: 0.2vh;
    opacity: 0.9;
  }
  
  .event-name {
    font-size: clamp(0.8rem, 2vw, 1.2rem);
    font-weight: 700;
    background: linear-gradient(135deg, #ff6b6b, #ffc93d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin-bottom: 0.2vh;
  }
  
  .event-status {
    font-size: clamp(0.5rem, 1vw, 0.7rem);
    color: var(--muted);
    letter-spacing: 0.05em;
  }
  
  .stats-btn {
    position: absolute;
    top: 50%;
    right: 2vw;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.1);
    border: 1px solid var(--line);
    color: var(--text);
    padding: 0.5vh 1vw;
    border-radius: 6px;
    cursor: pointer;
    font-size: clamp(0.6rem, 1.1vw, 0.75rem);
    transition: all 0.2s;
  }
  
  .stats-btn:hover {
    background: rgba(255,255,255,0.15);
    border-color: var(--vip);
  }
  
  .refresh-btn {
    position: absolute;
    top: 50%;
    left: 2vw;
    transform: translateY(-50%);
    background: rgba(76,175,80,0.2);
    border: 1px solid var(--success);
    color: var(--success);
    padding: 0.5vh 1vw;
    border-radius: 6px;
    cursor: pointer;
    font-size: clamp(0.6rem, 1.1vw, 0.75rem);
    transition: all 0.2s;
  }
  
  .refresh-btn:hover {
    background: rgba(76,175,80,0.3);
  }

  /* ===== SCREEN ===== */
  .screen-container {
    padding: 0.8vh 2vw 0.5vh;
    position: relative;
    flex-shrink: 0;
  }
  
  .screen {
    height: 0.3vh;
    min-height: 2px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255,193,61,0.3) 20%, 
      rgba(255,193,61,0.8) 50%, 
      rgba(255,193,61,0.3) 80%, 
      transparent 100%
    );
    border-radius: 50%;
    margin-bottom: 0.3vh;
    box-shadow: 0 0 20px rgba(255,193,61,0.4);
  }
  
  .screen-label {
    text-align: center;
    font-size: clamp(0.5rem, 1vw, 0.65rem);
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.7;
  }

  /* ===== SEATING MAP ===== */
  .seating-map {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1vh 1vw;
    overflow: auto;
  }
  
  .seating-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
  }
  
  .row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: clamp(2px, 0.3vw, 4px);
    margin-bottom: clamp(2px, 0.5vh, 6px);
    position: relative;
    width: 100%;
  }
  
  .section-divider {
    height: clamp(4px, 1vh, 12px);
    width: 100%;
    position: relative;
  }
  
  .section-divider::before {
    content: "";
    position: absolute;
    left: 20%;
    right: 20%;
    top: 50%;
    height: 1px;
    background: linear-gradient(90deg, 
      transparent, 
      var(--line) 20%, 
      var(--line) 80%, 
      transparent
    );
    opacity: 0.5;
  }
  
  .row-label {
    width: clamp(14px, 2vw, 20px);
    height: clamp(14px, 2vw, 20px);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: clamp(0.5rem, 1vw, 0.7rem);
    color: var(--muted);
    background: rgba(255,255,255,0.05);
    border-radius: 4px;
    margin: 0 clamp(2px, 0.3vw, 4px);
    flex-shrink: 0;
  }
  
  .row-label.vvip {
    color: var(--vip);
    background: rgba(255,193,61,0.1);
  }
  
  .row-label.sweet {
    color: var(--sweet);
    background: rgba(255,105,180,0.1);
  }
  
  .seat-block {
    display: flex;
    gap: clamp(2px, 0.3vw, 4px);
  }
  
  .center-aisle {
    width: clamp(8px, 1.5vw, 16px);
  }
  
  .seat {
    position: relative;
    width: clamp(16px, 2.5vw, 28px);
    height: clamp(16px, 2.5vw, 28px);
    flex-shrink: 0;
    cursor: pointer;
  }
  
  .seat-inner {
    display: block;
    width: 100%;
    height: 100%;
    background-size: contain;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: clamp(2px, 0.4vw, 6px);
    transition: all 0.2s ease;
    position: relative;
  }
  
  .seat.regular .seat-inner {
    background-image: var(--img-regular);
  }
  
  .seat.vip .seat-inner {
    background-image: var(--img-vip);
  }
  
  .seat.sweet .seat-inner {
    background-image: var(--img-sweet);
  }
  
  .seat:not(.booked):hover .seat-inner {
    transform: scale(1.1);
    filter: brightness(1.1);
  }
  
  .seat:not(.booked):active .seat-inner {
    transform: scale(0.95);
  }
  
  .seat.booked {
    cursor: pointer;
  }
  
  .seat.booked .seat-inner {
    opacity: 0.6;
  }
  
  .seat.booked .seat-inner::after {
    content: "";
    position: absolute;
    inset: 0;
    background: var(--img-person) center/65% no-repeat;
    filter: drop-shadow(0 1px 2px rgba(0,0,0,0.8));
  }

  /* ===== MODAL ===== */
  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.8);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }
  
  .modal.active {
    display: flex;
  }
  
  .modal-content {
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 12px;
    padding: 2rem;
    max-width: 90vw;
    width: 400px;
    max-height: 90vh;
    overflow-y: auto;
  }
  
  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
  }
  
  .modal-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--vip);
  }
  
  .modal-close {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .modal-close:hover {
    color: var(--text);
  }
  
  .form-group {
    margin-bottom: 1rem;
  }
  
  .form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text);
    font-size: 0.9rem;
    font-weight: 600;
  }
  
  .form-input, .form-select {
    width: 100%;
    padding: 0.75rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid var(--line);
    border-radius: 6px;
    color: var(--text);
    font-size: 0.9rem;
  }
  
  .form-input:focus, .form-select:focus {
    outline: none;
    border-color: var(--vip);
    background: rgba(255,255,255,0.08);
  }
  
  .btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--vip));
    color: white;
  }
  
  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255,107,107,0.4);
  }
  
  .btn-secondary {
    background: rgba(255,255,255,0.1);
    color: var(--text);
    border: 1px solid var(--line);
  }
  
  .btn-secondary:hover {
    background: rgba(255,255,255,0.15);
  }
  
  .modal-actions {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
  }
  
  .modal-actions .btn {
    flex: 1;
  }
  
  .info-item {
    padding: 0.75rem;
    background: rgba(255,255,255,0.03);
    border-radius: 6px;
    margin-bottom: 0.75rem;
  }
  
  .info-label {
    font-size: 0.75rem;
    color: var(--muted);
    margin-bottom: 0.25rem;
  }
  
  .info-value {
    font-size: 1rem;
    color: var(--text);
    font-weight: 600;
  }
  
  .seat-preview {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: linear-gradient(135deg, var(--accent), var(--vip));
    border-radius: 6px;
    font-size: 1.5rem;
    font-weight: 700;
    color: white;
    margin: 1rem 0;
  }

  /* ===== LEGEND ===== */
  .legend {
    padding: 0.8vh 2vw;
    background: rgba(255,255,255,0.02);
    border-top: 1px solid var(--line);
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: clamp(8px, 1.5vw, 15px);
    flex-shrink: 0;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    gap: clamp(4px, 0.6vw, 8px);
    font-size: clamp(0.55rem, 1.1vw, 0.7rem);
    color: var(--muted);
  }
  
  .legend-dot {
    width: clamp(12px, 1.8vw, 16px);
    height: clamp(10px, 1.5vw, 14px);
    border-radius: 3px;
    background: var(--accent);
    flex-shrink: 0;
  }
  
  .legend-dot.vip {
    background: var(--vip);
  }
  
  .legend-dot.sweet {
    background: var(--sweet);
  }
  
  .legend-dot.available {
    background: rgba(76,175,80,0.6);
  }
  
  .legend-dot.booked {
    background: rgba(255,255,255,0.3);
  }
  
  /* Loading */
  .loading {
    text-align: center;
    padding: 2rem;
    color: var(--muted);
  }
  
  .loading-spinner {
    border: 3px solid rgba(255,255,255,0.1);
    border-top-color: var(--vip);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }
  
  .stat-card {
    background: rgba(255,255,255,0.05);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
  }
  
  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--vip);
  }
  
  .stat-label {
    font-size: 0.8rem;
    color: var(--muted);
    margin-top: 0.5rem;
  }

  @media (max-width: 600px) {
    .modal-content {
      padding: 1.5rem;
      width: 95vw;
    }
    
    .stats-btn, .refresh-btn {
      font-size: 0.7rem;
      padding: 0.4vh 0.8vw;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <button class="refresh-btn" onclick="loadBookings()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
      <div class="event-title">HRA Function 2025</div>
      <div class="event-name">CINEMA CLUB</div>
      <div class="event-status">A Night to Remember ‚Ä¢ Live Booking</div>
      <button class="stats-btn" onclick="showStats()">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
    </header>
    
    <div class="screen-container">
      <div class="screen"></div>
      <div class="screen-label">Screen</div>
    </div>
    
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    </div>
    
    <main class="seating-map" id="seatingMap" style="display:none;">
      <div class="seating-wrapper" id="seatingWrapper"></div>
    </main>
    
    <footer class="legend">
      <div class="legend-item">
        <span class="legend-dot"></span>
        <span>Regular</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot sweet"></span>
        <span>Sweet</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot vip"></span>
        <span>VIP</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot available"></span>
        <span>‡∏ß‡πà‡∏≤‡∏á</span>
      </div>
      <div class="legend-item">
        <span class="legend-dot booked"></span>
        <span>‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</span>
      </div>
    </footer>
  </div>

  <!-- Modals -->
  <div id="bookModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á</h3>
        <button class="modal-close" onclick="closeModal('bookModal')">&times;</button>
      </div>
      
      <div style="text-align: center;">
        <div class="seat-preview" id="bookSeatPreview">-</div>
      </div>
      
      <form id="bookForm" onsubmit="submitBooking(event)">
        <div class="form-group">
          <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
          <input type="text" class="form-input" id="empNo" required placeholder="‡πÄ‡∏ä‡πà‡∏ô A9473">
        </div>
        
        <div class="form-group">
          <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</label>
          <input type="text" class="form-input" id="name" required placeholder="‡πÄ‡∏ä‡πà‡∏ô MRS. BENJAPAN BOONSANG-IN">
        </div>
        
        <div class="form-group">
          <label class="form-label">‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</label>
          <select class="form-select" id="factory" required>
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô --</option>
            <option value="AYUTTHAYA">AYUTTHAYA</option>
            <option value="BANGKOK">BANGKOK</option>
            <option value="CHONBURI">CHONBURI</option>
            <option value="RAYONG">RAYONG</option>
          </select>
        </div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" onclick="closeModal('bookModal')">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="submit" class="btn btn-primary">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </div>
      </form>
    </div>
  </div>

  <div id="viewModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
        <button class="modal-close" onclick="closeModal('viewModal')">&times;</button>
      </div>
      
      <div style="text-align: center;">
        <div class="seat-preview" id="viewSeatPreview">-</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
        <div class="info-value" id="viewEmpNo">-</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</div>
        <div class="info-value" id="viewName">-</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</div>
        <div class="info-value" id="viewFactory">-</div>
      </div>
      
      <div class="info-item">
        <div class="info-label">‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≠‡∏á</div>
        <div class="info-value" id="viewTime">-</div>
      </div>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('viewModal')">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>

  <div id="statsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h3>
        <button class="modal-close" onclick="closeModal('statsModal')">&times;</button>
      </div>
      
      <div class="stats-grid" id="statsGrid"></div>
      
      <div class="modal-actions">
        <button type="button" class="btn btn-secondary" onclick="closeModal('statsModal')">‡∏õ‡∏¥‡∏î</button>
      </div>
    </div>
  </div>
<script>
// ‚ö†Ô∏è IMPORTANT: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç API_URL ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Google Apps Script Deployment URL
const API_URL = 'https://script.google.com/macros/s/AKfycbzDFe-UmxrioicKjQRQmha9XLmkBZlcpmRS2PstuwiynZmyWXlNOdpXGKYUSr2-UqOE/exec';

// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î layout ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
const seatLayout = {
  'A': { count: 14, type: 'regular', split: 7 },
  'B': { count: 14, type: 'regular', split: 7 },
  'C': { count: 14, type: 'regular', split: 7 },
  'D': { count: 16, type: 'regular', split: 8 },
  'E': { count: 16, type: 'regular', split: 8 },
  'F': { count: 16, type: 'regular', split: 8 },
  'S': { count: 14, type: 'sweet', split: 7 },
  'L': { count: 14, type: 'vip', split: 7 }
};

let bookingsData = [];
let selectedSeat = null;

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à
window.onload = function() {
  loadBookings();
  // Auto refresh ‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (optional)
  setInterval(loadBookings, 30000);
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API ‡πÅ‡∏ö‡∏ö GET ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
async function apiGet(action, params = {}) {
  try {
    const url = new URL(API_URL);
    url.searchParams.append('action', action);
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° parameters ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô URL
    for (const [key, value] of Object.entries(params)) {
      if (value !== undefined && value !== null && value !== '') {
        url.searchParams.append(key, value);
      }
    }
    
    console.log('API Call:', url.toString());
    
    const response = await fetch(url.toString(), {
      method: 'GET',
      mode: 'cors',
      cache: 'no-cache'
    });
    
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }
    
    const data = await response.json();
    console.log('API Response:', data);
    return data;
    
  } catch (error) {
    console.error('API Error:', error);
    throw error;
  }
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
async function loadBookings() {
  document.getElementById('loading').style.display = 'block';
  document.getElementById('seatingMap').style.display = 'none';
  
  try {
    const result = await apiGet('getAllBookings');
    bookingsData = Array.isArray(result) ? result : [];
    console.log('Bookings loaded:', bookingsData);
    renderSeats();
    document.getElementById('loading').style.display = 'none';
    document.getElementById('seatingMap').style.display = 'flex';
    
  } catch (error) {
    console.error('Load Error:', error);
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
    bookingsData = [];
    renderSeats();
    document.getElementById('loading').style.display = 'none';
    document.getElementById('seatingMap').style.display = 'flex';
    
    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏°‡∏≤‡∏Å
    console.warn('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ');
  }
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ú‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
function renderSeats() {
  const wrapper = document.getElementById('seatingWrapper');
  wrapper.innerHTML = '';
  
  const rows = Object.keys(seatLayout);
  
  rows.forEach((rowId) => {
    const rowData = seatLayout[rowId];
    
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á section
    if (rowId === 'D' || rowId === 'S' || rowId === 'L') {
      const divider = document.createElement('div');
      divider.className = 'section-divider';
      wrapper.appendChild(divider);
    }
    
    const row = document.createElement('div');
    row.className = 'row';
    
    // Label ‡∏ã‡πâ‡∏≤‡∏¢
    const labelLeft = document.createElement('span');
    labelLeft.className = 'row-label';
    if (rowData.type === 'vip') labelLeft.classList.add('vvip');
    if (rowData.type === 'sweet') labelLeft.classList.add('sweet');
    labelLeft.textContent = rowId === 'L' ? 'VIP' : rowId;
    row.appendChild(labelLeft);
    
    // ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢
    const blockLeft = document.createElement('div');
    blockLeft.className = 'seat-block';
    for (let i = 1; i <= rowData.split; i++) {
      const seatId = rowId + i;
      blockLeft.appendChild(createSeat(seatId, rowData.type));
    }
    row.appendChild(blockLeft);
    
    // ‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á
    const aisle = document.createElement('div');
    aisle.className = 'center-aisle';
    row.appendChild(aisle);
    
    // ‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤
    const blockRight = document.createElement('div');
    blockRight.className = 'seat-block';
    for (let i = rowData.split + 1; i <= rowData.count; i++) {
      const seatId = rowId + i;
      blockRight.appendChild(createSeat(seatId, rowData.type));
    }
    row.appendChild(blockRight);
    
    // Label ‡∏Ç‡∏ß‡∏≤
    const labelRight = document.createElement('span');
    labelRight.className = 'row-label';
    if (rowData.type === 'vip') labelRight.classList.add('vvip');
    if (rowData.type === 'sweet') labelRight.classList.add('sweet');
    labelRight.textContent = rowId === 'L' ? 'VIP' : rowId;
    row.appendChild(labelRight);
    
    wrapper.appendChild(row);
  });
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ï‡∏±‡∏ß
function createSeat(seatId, type) {
  const seat = document.createElement('div');
  seat.className = 'seat ' + type;
  seat.setAttribute('data-seat-id', seatId);
  seat.setAttribute('title', '‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á ' + seatId);
  
  const booking = bookingsData.find(b => b.seatId === seatId);
  if (booking) {
    seat.classList.add('booked');
    seat.setAttribute('title', `‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß: ${booking.name}`);
    seat.onclick = () => viewBooking(booking);
  } else {
    seat.onclick = () => openBookModal(seatId);
  }
  
  const seatInner = document.createElement('div');
  seatInner.className = 'seat-inner';
  seat.appendChild(seatInner);
  
  return seat;
}

// ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á
function openBookModal(seatId) {
  selectedSeat = seatId;
  document.getElementById('bookSeatPreview').textContent = seatId;
  document.getElementById('bookModal').classList.add('active');
  document.getElementById('bookForm').reset();
  
  // Focus ‡∏ó‡∏µ‡πà input ‡πÅ‡∏£‡∏Å
  setTimeout(() => {
    document.getElementById('empNo').focus();
  }, 100);
}

// ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á (‡πÉ‡∏ä‡πâ GET)
async function submitBooking(event) {
  event.preventDefault();
  
  const empNo = document.getElementById('empNo').value.trim().toUpperCase();
  const name = document.getElementById('name').value.trim().toUpperCase();
  const factory = document.getElementById('factory').value;
  
  if (!empNo || !name || !factory || !selectedSeat) {
    alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô');
    return;
  }
  
  const submitBtn = event.target.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏≠‡∏á...';
  submitBtn.disabled = true;
  
  try {
    // ‡πÉ‡∏ä‡πâ GET request ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á parameters
    const result = await apiGet('bookSeat', {
      empNo: empNo,
      name: name,
      factory: factory,
      seatId: selectedSeat
    });
    
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
    
    if (result.success) {
      alert('‚úÖ ' + result.message);
      closeModal('bookModal');
      await loadBookings(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    } else {
      alert('‚ùå ' + (result.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'));
    }
  } catch (error) {
    submitBtn.textContent = originalText;
    submitBtn.disabled = false;
    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
  }
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
function viewBooking(booking) {
  document.getElementById('viewSeatPreview').textContent = booking.seatId;
  document.getElementById('viewEmpNo').textContent = booking.empNo;
  document.getElementById('viewName').textContent = booking.name;
  document.getElementById('viewFactory').textContent = booking.factory;
  
  // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
  if (booking.bookingTime) {
    const bookingTime = new Date(booking.bookingTime);
    const options = {
      year: 'numeric',
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit',
      hour12: false
    };
    document.getElementById('viewTime').textContent = bookingTime.toLocaleString('th-TH', options);
  } else {
    document.getElementById('viewTime').textContent = '-';
  }
  
  // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (optional)
  const modalActions = document.querySelector('#viewModal .modal-actions');
  const existingCancelBtn = modalActions.querySelector('.btn-danger');
  
  if (!existingCancelBtn) {
    const cancelBtn = document.createElement('button');
    cancelBtn.className = 'btn btn-danger';
    cancelBtn.textContent = '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á';
    cancelBtn.onclick = () => cancelBookingConfirm(booking.empNo);
    modalActions.insertBefore(cancelBtn, modalActions.firstChild);
  }
  
  document.getElementById('viewModal').classList.add('active');
}

// ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
async function cancelBookingConfirm(empNo) {
  if (!confirm('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ')) {
    return;
  }
  
  try {
    const result = await apiGet('cancelBooking', { empNo: empNo });
    
    if (result.success) {
      alert('‚úÖ ' + result.message);
      closeModal('viewModal');
      await loadBookings();
    } else {
      alert('‚ùå ' + (result.message || '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ'));
    }
  } catch (error) {
    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
  }
}

// ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
async function showStats() {
  try {
    const stats = await apiGet('getBookingStats');
    const grid = document.getElementById('statsGrid');
    grid.innerHTML = '';
    
    // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏´‡∏•‡∏±‡∏Å
    grid.innerHTML += `
      <div class="stat-card">
        <div class="stat-value">${stats.total || 0}</div>
        <div class="stat-label">‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${104 - (stats.total || 0)}</div>
        <div class="stat-label">‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏ß‡πà‡∏≤‡∏á</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${stats.regular || 0}</div>
        <div class="stat-label">Regular</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${stats.sweet || 0}</div>
        <div class="stat-label">Sweet</div>
      </div>
      <div class="stat-card">
        <div class="stat-value">${stats.vip || 0}</div>
        <div class="stat-label">VIP</div>
      </div>
    `;
    
    // ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô
    if (stats.factories) {
      const factoryHeader = document.createElement('div');
      factoryHeader.style.width = '100%';
      factoryHeader.style.textAlign = 'center';
      factoryHeader.style.marginTop = '1rem';
      factoryHeader.innerHTML = '<h4 style="color: var(--muted);">‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô</h4>';
      grid.appendChild(factoryHeader);
      
      Object.keys(stats.factories).forEach(factory => {
        grid.innerHTML += `
          <div class="stat-card">
            <div class="stat-value">${stats.factories[factory]}</div>
            <div class="stat-label">${factory}</div>
          </div>
        `;
      });
    }
    
    document.getElementById('statsModal').classList.add('active');
  } catch (error) {
    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÑ‡∏î‡πâ: ' + error.message);
  }
}

// ‡∏õ‡∏¥‡∏î Modal
function closeModal(modalId) {
  document.getElementById(modalId).classList.remove('active');
  
  // Clear selected seat ‡∏ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î book modal
  if (modalId === 'bookModal') {
    selectedSeat = null;
  }
}

// ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', function(e) {
    if (e.target === this) {
      this.classList.remove('active');
      if (this.id === 'bookModal') {
        selectedSeat = null;
      }
    }
  });
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
  // ESC to close modal
  if (e.key === 'Escape') {
    document.querySelectorAll('.modal.active').forEach(modal => {
      modal.classList.remove('active');
    });
    selectedSeat = null;
  }
  
  // F5 or Ctrl+R to refresh
  if (e.key === 'F5' || (e.ctrlKey && e.key === 'r')) {
    e.preventDefault();
    loadBookings();
  }
});

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (optional)
async function checkMyBooking() {
  const empNo = prompt('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á:');
  if (!empNo) return;
  
  try {
    const booking = await apiGet('getMyBooking', { empNo: empNo.toUpperCase() });
    
    if (booking) {
      alert(`‚úÖ ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á: ${booking.seatId}\n‡∏ä‡∏∑‡πà‡∏≠: ${booking.name}\n‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô: ${booking.factory}`);
    } else {
      alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì');
    }
  } catch (error) {
    alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
  }
}

// Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏ô CSS ‡∏´‡∏£‡∏∑‡∏≠ inline)
const style = document.createElement('style');
style.textContent = `
  .btn-danger {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
  }
  .btn-danger:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
  }
`;
document.head.appendChild(style);

// Debug function (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö development)
function debugInfo() {
  console.log('Current Bookings:', bookingsData);
  console.log('Total Seats:', 104);
  console.log('Booked Seats:', bookingsData.length);
  console.log('Available Seats:', 104 - bookingsData.length);
}

// Export for debugging (optional)
window.cinemaDebug = {
  bookings: () => bookingsData,
  refresh: () => loadBookings(),
  stats: () => showStats(),
  checkMy: () => checkMyBooking(),
  info: () => debugInfo()
};
</script>
</body>
</html>
